<html>
<head>
    <title>Circular graphics</title>
    <!--<script src="https://code.createjs.com/createjs-2015.05.21.min.js"></script>-->
    <script src="static/createjs-2015.05.21.min.js"></script>
    <script src="static/dayclock.js"></script>
    <style>
        body {
            background: #000000;
        }

        /*horizontally center the canvas*/
        #demoCanvas {
            display: block;
            margin: 0 auto;
            background: #ffffff;
        }
    </style>
    <script>
    	var canvas, stage;
        var face;

        function init() {
            canvas = document.getElementById("demoCanvas");
            stage = new createjs.Stage(canvas);

            var xCenter = canvas.width / 2;
            var yCenter = canvas.height / 2;

            face = new createjs.Container();
            stage.addChild(face);

            // TODO can get x y from face?
            draw(face, xCenter, yCenter);

            createjs.Ticker.addEventListener("tick", tick);
        }

        function draw(face, xCenter, yCenter) {

		    var rows = [
                [
                    {name: "A", start: 0, end: 1, color: "lightblue", xheight: 2}
                ],
		        [
                    {name: "B", start: 0.1, end: 0.4, color: "red"},
                    {name: "C", start: 0.4, end: 0.6, color: "#00e010"}
                ],
                [
                    {name: "D", start: 0, end: 1, color: "lightblue", xheight: 2}
                ],
                [
                    {name: "E", start: 0.76, end: 1.1, color: "blue"}
                ],
                [
                    {name: "F", start: 0, end: 0.25, color: "green"},
                    {name: "G", start: 0.50, end: 0.75, color: "green"}
                ],
//                []
            ];

            console.log(rows);

            var maxRadius = 200;
            var gap = Math.floor(maxRadius / 100);

            // TODO minus sum of optional specified heights and row gaps
            var reservedHeight = 0;

            var height = Math.floor((maxRadius - ((rows.length) * gap) - reservedHeight) / (rows.length));

            console.log("gap " + gap);
            console.log("reservedHeight " + reservedHeight);
            console.log("height " + height);

            var radius = maxRadius;

            var cells = [];

            for (var r=0; r < rows.length; r++) {
                console.log("adding outer row " + r);
                var row = rows[r];

                for (var c=0; c < row.length; c++) {
                    var cell = row[c];
                    var h = cell.height || height;
                    var data = {name: cell.name, radius: radius - h, height: h, start: cell.start, end: cell.end, color: cell.color};
                    cells.push(data);

                    console.log("adding row " + r + ", cell " + c);
                    console.log(data);
                }

                radius = radius - h - gap;
            }

            addCells(face, xCenter, yCenter, cells);

            createjs.Ticker.addEventListener("tick", tick);
        }

        function tick(event) {

            for (var i=0; i < face.numChildren; i++) {
                var child = face.getChildAt(i);
                child.rotation += child.rotateRate;
            }

            stage.update(event);
        }

    </script>
</head>
<body onload="init();">
<canvas id="demoCanvas" width="400" height="400"></canvas>
</body>
</html>