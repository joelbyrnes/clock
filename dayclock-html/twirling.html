<html>
<head>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>Circular graphics - Twirling</title>
    <!--<script src="https://code.createjs.com/createjs-2015.05.21.min.js"></script>-->
    <script src="static/createjs-2015.05.21.min.js"></script>
    <script src="static/dayclock.js"></script>
    <style>
        body {
            background: #000000;
            padding: 0;
            margin: 0;
        }

        /*horizontally center the canvas*/
        #demoCanvas {
            display: block;
            margin: 0 auto;
            /*background: #222222;*/
        }
    </style>
    <script>
    	var stage;
        var face;
        var animate = true;
        var rotateFactor = 1;

        function init() {
            var canvas = document.getElementById("demoCanvas");
            canvas.width = document.body.clientWidth; //document.width is obsolete
            canvas.height = document.body.clientHeight; //document.height is obsolete

            stage = new createjs.Stage(canvas);

            var ow = window.innerWidth;
            var oh = window.innerHeight;
            var xCenter = ow / 2;
            var yCenter = oh / 2;
            // more accurately, distance from xy and edge?
            var maxRadius = Math.floor(Math.min(ow / 2, oh / 2));

            face = new CircularGraphics(xCenter, yCenter);
            stage.addChild(face);
            draw(face, maxRadius);
            resizeStage(stage, ow, oh, true);

            createjs.Ticker.addEventListener("tick", tick);

            window.onresize = function() {
                resizeStage(stage, ow, oh, true);
            }
        }

        function draw(face, maxRadius) {
            var layers = 32;
            var rotationRatio = 0.25;
            var layerHeightFactor = 1.6; // overlap
            var circumferenceFactor = 0.3333;
            var alpha = 0.9;

            var radius = maxRadius * 0.95;
            var minRadius = radius * 0.10;
            var layerHeight = (radius - minRadius) / layers;

            var sector = {
                height: layerHeight * layerHeightFactor,
                start: 0, end: circumferenceFactor
            };

            for (var i=0; i < layers; i++) {
                var hue = 290 - i * 1.8;

                sector.i = i;
                sector.radius = radius - i * layerHeight;
                sector.color = "hsla(" + hue + ", 80%, 45%, " + alpha + ")";
                sector.rotateRate = 1 + (i * rotationRatio);

                console.log(sector);
                face.addSector(sector);

//                sector.start = sector.start + (circumferenceFactor * 2);
//                sector.end = sector.end + (circumferenceFactor * 2);
//                face.addSector(sector);
            }
        }

        function tick(event) {

            if (animate) {
                face.update();

                stage.update(event);
            }
        }

    </script>
</head>
<body onload="init();">
<canvas id="demoCanvas"></canvas>
</body>
</html>